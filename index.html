<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>çš®å¡ä¸˜çš„ä»£ç†ç«™ Â· Pikachu Proxy Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ===== åŸºç¡€æ ·å¼ ===== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      color: #e5e7eb;
      overflow: hidden;
    }
    canvas#bg {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }
    .app {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      backdrop-filter: blur(20px);
      background: linear-gradient(135deg, rgba(15,23,42,0.7), rgba(15,23,42,0.3));
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.6);
      background: radial-gradient(circle at top left, rgba(56,189,248,0.35), rgba(15,23,42,0.95));
      box-shadow: 0 16px 40px rgba(0,0,0,0.7);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff7cc, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 30px rgba(250,204,21,0.5);
      border: 1px solid rgba(252,211,77,0.8);
    }
    .logo span { font-size: 22px; }
    .title-main {
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .title-main small {
      font-size: 11px;
      padding: 0 6px;
      border-radius: 999px;
      border: 1px solid rgba(251,191,36,0.7);
      background: rgba(15,23,42,0.8);
      color: #facc15;
    }
    .subtitle {
      font-size: 12px;
      color: #9ca3af;
    }
    .header-right {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.7);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: 0.15s;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.7);
      background: rgba(17,24,39,1);
    }

    /* ===== å¸ƒå±€ ===== */
    main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.2fr);
      gap: 12px;
      min-height: 0;
    }
    @media (max-width: 900px) {
      main { grid-template-columns: minmax(0, 1fr); }
    }
    .card {
      background: rgba(15,23,42,0.9);
      border-radius: 18px;
      border: 1px solid rgba(31,41,55,0.9);
      box-shadow: 0 18px 50px rgba(0,0,0,0.7);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    .card h2 {
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card h2 span.badge {
      font-size: 11px;
      padding: 0 6px;
      border-radius: 999px;
      border: 1px solid rgba(96,165,250,0.7);
      color: #bfdbfe;
    }
    .card-desc {
      font-size: 12px;
      color: #9ca3af;
    }

    /* ===== ä»£ç†è¡¨ ===== */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      align-items: center;
    }
    .filters input, .filters select {
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.8);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      padding: 4px 8px;
      outline: none;
    }
    .filters input::placeholder {
      color: rgba(148,163,253,0.8);
    }
    .table-wrap {
      flex: 1;
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid rgba(55,65,81,0.9);
      overflow: hidden;
      background: rgba(15,23,42,0.98);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    thead {
      background: linear-gradient(to right, #1d4ed8, #0f766e);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    th, td {
      text-align: left;
      padding: 5px 8px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      white-space: nowrap;
    }
    tbody tr:nth-child(2n) td {
      background: rgba(15,23,42,0.98);
    }
    tbody tr:nth-child(2n+1) td {
      background: rgba(17,24,39,0.98);
    }
    tbody tr:hover td {
      background: rgba(59,130,246,0.35);
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    .chip {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(45,212,191,0.8);
      padding: 1px 6px;
      font-size: 11px;
      color: #99f6e4;
      background: rgba(15,118,110,0.4);
    }
    .speed-bar {
      width: 70px;
      height: 4px;
      border-radius: 999px;
      background: #111827;
      overflow: hidden;
      display: inline-block;
      vertical-align: middle;
      margin-right: 4px;
    }
    .speed-bar div {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
      transform-origin: left center;
      transform: scaleX(0.6);
    }
    .footer-text {
      margin-top: 4px;
      font-size: 11px;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ===== æµ‹è¯•å®éªŒå®¤ ===== */
    .lab-form {
      border-radius: 12px;
      border: 1px solid rgba(55,65,81,0.9);
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .lab-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .lab-label {
      font-size: 12px;
      color: #9ca3af;
      min-width: 70px;
    }
    .lab-input {
      flex: 1;
      min-width: 0;
    }
    .lab-input input, .lab-input select {
      width: 100%;
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.8);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      padding: 4px 8px;
      outline: none;
    }
    .preview {
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      padding: 6px;
      font-size: 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas;
      max-height: 100px;
      overflow: auto;
    }
    .log-card {
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid rgba(30,64,175,0.9);
      background: radial-gradient(circle at top left, rgba(37,99,235,0.5), rgba(15,23,42,0.98));
      padding: 6px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 1px 8px;
      font-size: 11px;
    }
    .status-idle {
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(17,24,39,0.95);
      color: #d1d5db;
    }
    .status-running {
      border: 1px solid rgba(74,222,128,0.9);
      background: rgba(22,101,52,0.95);
      color: #bbf7d0;
    }
    .status-error {
      border: 1px solid rgba(248,113,113,0.9);
      background: rgba(127,29,29,0.95);
      color: #fecaca;
    }
    .log-box {
      border-radius: 8px;
      background: rgba(15,23,42,0.98);
      padding: 4px 6px;
      max-height: 120px;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas;
    }
    .pikachu-note {
      margin-top: 4px;
      border-radius: 10px;
      border: 1px dashed rgba(250,204,21,0.9);
      background: rgba(30,64,175,0.7);
      font-size: 11px;
      padding: 4px 6px;
      display: flex;
      gap: 4px;
      color: #fef3c7;
    }
    .small {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }
  </style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="app">
  <header>
    <div class="brand">
      <div class="logo"><span>âš¡</span></div>
      <div>
        <div class="title-main">
          <span id="title-text">çš®å¡ä¸˜çš„ä»£ç†ç«™</span>
          <small>Pikachu Proxy Hub</small>
        </div>
        <div class="subtitle" id="subtitle-text">
          å¯è§†åŒ–å±•ç¤ºå…è´¹ä»£ç† Â· å¤šåè®®æ”¯æŒ Â· GitHub Actions è‡ªåŠ¨æ›´æ–° Â· çš®å¡ä¸˜é™ªä½ å®‰å…¨å†²æµª âš¡
        </div>
      </div>
    </div>
    <div class="header-right">
      <button id="lang-btn"><span id="lang-flag">ğŸ‡¨ğŸ‡³</span><span>ä¸­æ–‡ / English</span></button>
      <button id="pattern-btn"><span>âœ¨</span><span id="pattern-text">åˆ‡æ¢ç²’å­å›¾æ¡ˆ</span></button>
    </div>
  </header>

  <main>
    <!-- å·¦ä¾§ï¼šä»£ç†åˆ—è¡¨ -->
    <section class="card">
      <div>
        <h2>ğŸ“¡ <span id="list-title">å®æ—¶ä»£ç†åˆ—è¡¨</span> <span class="badge" id="list-badge">å¤šåè®® Â· å…è´¹æº</span></h2>
        <div class="card-desc" id="list-desc">
          ä» GitHub ä»“åº“æ ¹ç›®å½•çš„ proxies.json è¯»å–æ•°æ®ï¼Œproxies.json ç”± GitHub Actions å®šæ—¶æ›´æ–°ã€‚
        </div>
      </div>

      <div class="filters">
        <input id="search-input" placeholder="æœç´¢ IP / åè®® / ä½ç½®...">
        <select id="country-filter">
          <option value="">å…¨éƒ¨å›½å®¶</option>
        </select>
        <select id="protocol-filter">
          <option value="">å…¨éƒ¨åè®®</option>
          <option value="Http">Http</option>
          <option value="Https">Https</option>
          <option value="Socks4">Socks4</option>
          <option value="Socks5">Socks5</option>
        </select>
      </div>

      <div class="table-wrap">
        <div style="max-height:340px; overflow:auto;">
          <table>
            <thead>
            <tr>
              <th>#</th>
              <th id="th-country">å›½å®¶</th>
              <th id="th-ip">IP:ç«¯å£</th>
              <th id="th-proto">åè®®</th>
              <th id="th-anon">åŒ¿å</th>
              <th id="th-speed">é€Ÿåº¦</th>
            </tr>
            </thead>
            <tbody id="proxy-tbody">
            <tr><td colspan="6" style="font-size:12px;color:#fecaca;">
              æ­£åœ¨åŠ è½½ä»£ç†åˆ—è¡¨...
            </td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="footer-text">
        <span id="stats-text">å…± 0 æ¡ä»£ç†ï¼Œå½“å‰æ˜¾ç¤º 0 æ¡ã€‚</span>
        <span id="update-time"></span>
      </div>
    </section>

    <!-- å³ä¾§ï¼šæµ‹è¯•å®éªŒå®¤ -->
    <section class="card">
      <div>
        <h2>ğŸ§ª <span id="lab-title">ä»£ç†æµ‹è¯•å®éªŒå®¤</span> <span class="badge" id="lab-badge">æµç¨‹æ¼”ç¤º Â· cURL ç¤ºä¾‹</span></h2>
        <div class="card-desc" id="lab-desc">
          ä»å·¦ä¾§åˆ—è¡¨é€‰ä¸€ä¸ªä»£ç†ï¼Œä¸€é”®ç”Ÿæˆ curl å‘½ä»¤ï¼Œå¹¶æ¨¡æ‹Ÿå±•ç¤ºè¯·æ±‚è¿‡ç¨‹å’Œç»“æœã€‚
        </div>
      </div>
      <div class="lab-form">
        <div class="lab-row">
          <div class="lab-label" id="url-label">ç›®æ ‡ URL</div>
          <div class="lab-input">
            <input id="test-url" placeholder="ä¾‹å¦‚ï¼šhttps://httpbin.org/ip">
          </div>
        </div>
        <div class="lab-row">
          <div class="lab-label" id="proxy-label">é€‰æ‹©ä»£ç†</div>
          <div class="lab-input">
            <select id="proxy-select">
              <option value="">è¯·å…ˆåŠ è½½ä»£ç†åˆ—è¡¨</option>
            </select>
          </div>
        </div>
        <div style="display:flex;justify-content:flex-end;">
          <button id="run-btn"><span>âš¡</span><span id="run-text">å¼€å§‹æ¨¡æ‹Ÿæµ‹è¯•</span></button>
        </div>
      </div>

      <div class="preview">
        <div id="preview-title">cURL ç¤ºä¾‹ï¼ˆå‰ç«¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ä»£ç†ï¼Œè¯·åœ¨åç«¯çœŸå®æ‰§è¡Œï¼‰</div>
        <pre id="preview-cmd">curl -x http://IP:PORT https://httpbin.org/ip</pre>
      </div>

      <div class="log-card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <span id="log-title">è¯·æ±‚è¿‡ç¨‹ä¸ç»“æœï¼ˆæ¨¡æ‹Ÿï¼‰</span>
          <span id="status-pill" class="status-pill status-idle">ğŸ’¤ ç©ºé—²</span>
        </div>
        <div class="log-box" id="log-box">
          ç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿæµ‹è¯•ã€åï¼Œè¿™é‡Œä¼šæŒ‰æ­¥éª¤å±•ç¤ºé€šè¿‡ä»£ç†å‘é€è¯·æ±‚çš„è¿‡ç¨‹ã€‚
        </div>
        <div class="small" id="lab-tip">
          æ³¨æ„ï¼šæµè§ˆå™¨ JS ä¸èƒ½åƒ curl ä¸€æ ·ç›´æ¥ç”¨ HTTP ä»£ç†ã€‚çœŸå®æµ‹è¯•è¯·åœ¨åç«¯å®ç° /test-proxy æ¥å£ï¼Œå†æŠŠç»“æœå±•ç¤ºåœ¨è¿™é‡Œã€‚
        </div>
      </div>

      <div class="pikachu-note">
        <span>âš¡</span>
        <span id="pikachu-note">
          çš®å¡ä¸˜æç¤ºï¼šä½ å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå®ç°ä¸€ä¸ª /test-proxy æ¥å£ï¼Œæ¥æ”¶ {ip,port,url}ï¼Œç”¨ä»£ç†å»è¯·æ±‚ï¼Œç„¶åæŠŠçœŸå®è¿”å›ç»“æœæ˜¾ç¤ºåœ¨ä¸Šé¢çš„æ—¥å¿—é‡Œã€‚
        </span>
      </div>
    </section>
  </main>
</div>

<script>
  /**************** ç²’å­èƒŒæ™¯ï¼š3 ç§æ¨¡å¼ ****************/
  (function () {
    const canvas = document.getElementById("bg");
    const ctx = canvas.getContext("2d");
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener("resize", resize);

    const particles = [];
    const N = 120;
    let mode = 0; // 0: é£˜åŠ¨, 1: æ—‹è½¬ç¯, 2: å¿ƒå½¢
    const center = () => ({ x: canvas.width / 2, y: canvas.height / 2 });

    for (let i = 0; i < N; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        vx: (Math.random() - 0.5) * 0.4,
        vy: (Math.random() - 0.5) * 0.4,
        r: Math.random() * 2 + 0.5,
        a: Math.random() * Math.PI * 2,
        t: Math.random() * Math.PI * 2,
        radius: 40 + Math.random() * 120
      });
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.globalAlpha = 1;
      ctx.globalCompositeOperation = "lighter";

      const c = center();
      const time = Date.now() * 0.0005;

      for (let i = 0; i < N; i++) {
        const p = particles[i];
        if (mode === 0) {
          p.x += p.vx;
          p.y += p.vy;
          if (p.x < -50 || p.x > canvas.width + 50 || p.y < -50 || p.y > canvas.height + 50) {
            p.x = Math.random() * canvas.width;
            p.y = Math.random() * canvas.height;
          }
        } else if (mode === 1) {
          p.a += 0.01;
          const r = p.radius + Math.sin(time + i * 0.1) * 14;
          p.x = c.x + Math.cos(p.a) * r;
          p.y = c.y + Math.sin(p.a) * r * 0.6;
        } else {
          p.t += 0.02;
          const t = p.t;
          const sx = 16 * Math.pow(Math.sin(t), 3);
          const sy =
            13 * Math.cos(t) -
            5 * Math.cos(2 * t) -
            2 * Math.cos(3 * t) -
            Math.cos(4 * t);
          const S = Math.min(canvas.width, canvas.height) * 0.05;
          p.x = c.x + sx * S;
          p.y = c.y - sy * S;
        }

        const grd = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 4);
        grd.addColorStop(0, "rgba(255,253,230,0.9)");
        grd.addColorStop(0.3, "rgba(250,204,21,0.8)");
        grd.addColorStop(1, "rgba(30,64,175,0)");
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r * 3, 0, Math.PI * 2);
        ctx.fill();
      }
      requestAnimationFrame(draw);
    }
    draw();

    const patternBtn = document.getElementById("pattern-btn");
    if (patternBtn) {
      patternBtn.addEventListener("click", () => {
        mode = (mode + 1) % 3;
        const label = document.getElementById("pattern-text");
        if (!label) return;
        if (mode === 0) label.textContent = currentLang === "zh" ? "åˆ‡æ¢ç²’å­å›¾æ¡ˆï¼ˆé£˜åŠ¨ï¼‰" : "Pattern: float";
        if (mode === 1) label.textContent = currentLang === "zh" ? "åˆ‡æ¢ç²’å­å›¾æ¡ˆï¼ˆå…‰ç¯ï¼‰" : "Pattern: ring";
        if (mode === 2) label.textContent = currentLang === "zh" ? "åˆ‡æ¢ç²’å­å›¾æ¡ˆï¼ˆçˆ±å¿ƒï¼‰" : "Pattern: heart";
      });
    }
  })();

  /**************** å¤šè¯­è¨€åˆ‡æ¢ ****************/
  let currentLang = "zh";
  let allProxies = [];
  let lastUpdated = "";

  function setUpdateTime() {
    const el = document.getElementById("update-time");
    if (!el) return;
    if (!lastUpdated) {
      el.textContent = "";
      return;
    }
    el.textContent =
      currentLang === "zh"
        ? `æ•°æ®æ›´æ–°æ—¶é—´ï¼š${lastUpdated}`
        : `Updated at: ${lastUpdated}`;
  }

  function updateStats() {
    const total = allProxies.length;
    const tbody = document.getElementById("proxy-tbody");
    let visible = 0;
    if (tbody) {
      const rows = [...tbody.children];
      visible = rows.filter(tr => tr.children.length && tr.children[0].textContent !== "").length;
    }
    const el = document.getElementById("stats-text");
    if (!el) return;
    if (currentLang === "zh") {
      el.textContent = `å…± ${total} æ¡ä»£ç†ï¼Œå½“å‰æ˜¾ç¤º ${visible || total} æ¡ã€‚`;
    } else {
      el.textContent = `${visible || total} shown out of ${total} proxies.`;
    }
  }

  function applyLang() {
    if (currentLang === "zh") {
      document.getElementById("title-text").textContent = "çš®å¡ä¸˜çš„ä»£ç†ç«™";
      document.getElementById("subtitle-text").textContent =
        "å¯è§†åŒ–å±•ç¤ºå…è´¹ä»£ç† Â· å¤šåè®®æ”¯æŒ Â· GitHub Actions è‡ªåŠ¨æ›´æ–° Â· çš®å¡ä¸˜é™ªä½ å®‰å…¨å†²æµª âš¡";
      document.getElementById("lang-flag").textContent = "ğŸ‡¨ğŸ‡³";

      document.getElementById("list-title").textContent = "å®æ—¶ä»£ç†åˆ—è¡¨";
      document.getElementById("list-badge").textContent = "å¤šåè®® Â· å…è´¹æº";
      document.getElementById("list-desc").textContent =
        "ä» GitHub ä»“åº“æ ¹ç›®å½•çš„ proxies.json è¯»å–æ•°æ®ï¼Œproxies.json ç”± GitHub Actions å®šæ—¶æ›´æ–°ã€‚";
      document.getElementById("search-input").placeholder = "æœç´¢ IP / åè®® / ä½ç½®...";
      document.getElementById("th-country").textContent = "å›½å®¶";
      document.getElementById("th-ip").textContent = "IP:ç«¯å£";
      document.getElementById("th-proto").textContent = "åè®®";
      document.getElementById("th-anon").textContent = "åŒ¿å";
      document.getElementById("th-speed").textContent = "é€Ÿåº¦";

      document.getElementById("lab-title").textContent = "ä»£ç†æµ‹è¯•å®éªŒå®¤";
      document.getElementById("lab-badge").textContent = "æµç¨‹æ¼”ç¤º Â· cURL ç¤ºä¾‹";
      document.getElementById("lab-desc").textContent =
        "ä»å·¦ä¾§åˆ—è¡¨é€‰ä¸€ä¸ªä»£ç†ï¼Œä¸€é”®ç”Ÿæˆ curl å‘½ä»¤ï¼Œå¹¶æ¨¡æ‹Ÿå±•ç¤ºè¯·æ±‚è¿‡ç¨‹å’Œç»“æœã€‚";
      document.getElementById("url-label").textContent = "ç›®æ ‡ URL";
      document.getElementById("test-url").placeholder = "ä¾‹å¦‚ï¼šhttps://httpbin.org/ip";
      document.getElementById("proxy-label").textContent = "é€‰æ‹©ä»£ç†";
      document.getElementById("run-text").textContent = "å¼€å§‹æ¨¡æ‹Ÿæµ‹è¯•";
      document.getElementById("preview-title").textContent =
        "cURL ç¤ºä¾‹ï¼ˆå‰ç«¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ä»£ç†ï¼Œè¯·åœ¨åç«¯çœŸå®æ‰§è¡Œï¼‰";
      document.getElementById("log-title").textContent = "è¯·æ±‚è¿‡ç¨‹ä¸ç»“æœï¼ˆæ¨¡æ‹Ÿï¼‰";
      document.getElementById("lab-tip").textContent =
        "æ³¨æ„ï¼šæµè§ˆå™¨ JS ä¸èƒ½åƒ curl ä¸€æ ·ç›´æ¥ç”¨ HTTP ä»£ç†ã€‚çœŸå®æµ‹è¯•è¯·åœ¨åç«¯å®ç° /test-proxy æ¥å£ï¼Œå†æŠŠç»“æœå±•ç¤ºåœ¨è¿™é‡Œã€‚";
      document.getElementById("pikachu-note").textContent =
        "çš®å¡ä¸˜æç¤ºï¼šä½ å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå®ç°ä¸€ä¸ª /test-proxy æ¥å£ï¼Œæ¥æ”¶ {ip,port,url}ï¼Œç”¨ä»£ç†å»è¯·æ±‚ï¼Œç„¶åæŠŠçœŸå®è¿”å›ç»“æœæ˜¾ç¤ºåœ¨ä¸Šé¢çš„æ—¥å¿—é‡Œã€‚";

      document.getElementById("pattern-text").textContent = "åˆ‡æ¢ç²’å­å›¾æ¡ˆ";
    } else {
      document.getElementById("title-text").textContent = "Pikachu Proxy Hub";
      document.getElementById("subtitle-text").textContent =
        "Visualize free proxies Â· Multi-protocol support Â· Auto-updated by GitHub Actions âš¡";
      document.getElementById("lang-flag").textContent = "ğŸ‡ºğŸ‡¸";

      document.getElementById("list-title").textContent = "Live Proxy List";
      document.getElementById("list-badge").textContent = "Multi-protocol Â· Free source";
      document.getElementById("list-desc").textContent =
        "Reads from proxies.json in this repo; proxies.json is periodically updated by a GitHub Actions workflow.";
      document.getElementById("search-input").placeholder = "Search IP / protocol / location...";
      document.getElementById("th-country").textContent = "Country";
      document.getElementById("th-ip").textContent = "IP:Port";
      document.getElementById("th-proto").textContent = "Protocol(s)";
      document.getElementById("th-anon").textContent = "Anonymity";
      document.getElementById("th-speed").textContent = "Speed";

      document.getElementById("lab-title").textContent = "Proxy Test Lab";
      document.getElementById("lab-badge").textContent = "Flow demo Â· cURL example";
      document.getElementById("lab-desc").textContent =
        "Pick a proxy on the left, auto-generate a curl command and simulate the request flow.";
      document.getElementById("url-label").textContent = "Target URL";
      document.getElementById("test-url").placeholder = "e.g. https://httpbin.org/ip";
      document.getElementById("proxy-label").textContent = "Proxy";
      document.getElementById("run-text").textContent = "Run simulated test";
      document.getElementById("preview-title").textContent =
        "cURL example (frontend JS cannot directly use HTTP proxies; execute on server side).";
      document.getElementById("log-title").textContent = "Request flow & result (simulation)";
      document.getElementById("lab-tip").textContent =
        "Note: browser JS cannot use HTTP proxies like curl. Implement a /test-proxy endpoint on your server and show its results here.";
      document.getElementById("pikachu-note").textContent =
        "Pikachu tip: implement /test-proxy on your server to send requests via {ip,port,url} and display the real response above.";

      document.getElementById("pattern-text").textContent = "Switch particle pattern";
    }
    updateStats();
    setUpdateTime();
  }

  document.getElementById("lang-btn").addEventListener("click", () => {
    currentLang = currentLang === "zh" ? "en" : "zh";
    applyLang();
  });

  /**************** ä»£ç†æ•°æ®ï¼šåªä»æœ¬ä»“åº“çš„ proxies.json è¯»å– ****************/
  const API_URL = "./proxies.json";

  function renderCountryFilter() {
    const sel = document.getElementById("country-filter");
    if (!sel) return;
    const oldVal = sel.value;
    sel.innerHTML = "";
    const optAll = document.createElement("option");
    optAll.value = "";
    optAll.textContent = currentLang === "zh" ? "å…¨éƒ¨å›½å®¶" : "All countries";
    sel.appendChild(optAll);

    const set = new Set(allProxies.map(p => p.country).filter(Boolean));
    [...set].sort().forEach(c => {
      const o = document.createElement("option");
      o.value = c;
      o.textContent = c;
      sel.appendChild(o);
    });
    sel.value = oldVal;
  }

  function fillProxySelect(list) {
    const sel = document.getElementById("proxy-select");
    if (!sel) return;
    sel.innerHTML = "";
    const defaultOpt = document.createElement("option");
    defaultOpt.value = "";
    defaultOpt.textContent =
      currentLang === "zh" ? "è¯·é€‰æ‹©ä¸€ä¸ªä»£ç†" : "Choose a proxy";
    sel.appendChild(defaultOpt);

    (list.length ? list : allProxies).slice(0, 200).forEach((p, idx) => {
      const o = document.createElement("option");
      o.value = idx;
      o.textContent = `[${p.country || "-"}] ${p.ip}:${p.port} (${p.protocol})`;
      o.dataset.ip = p.ip;
      o.dataset.port = p.port;
      o.dataset.protocol = p.protocol;
      sel.appendChild(o);
    });
    updatePreviewCmd();
  }

  function applyFiltersAndRender() {
    const tbody = document.getElementById("proxy-tbody");
    if (!tbody) return;
    tbody.innerHTML = "";

    const keyword = document.getElementById("search-input").value.trim().toLowerCase();
    const country = document.getElementById("country-filter").value;
    const proto = document.getElementById("protocol-filter").value;

    const list = allProxies.filter(p => {
      if (country && p.country !== country) return false;
      if (proto && !String(p.protocol).toLowerCase().includes(proto.toLowerCase())) return false;
      if (keyword) {
        const t = [p.ip, p.country || "", p.protocol || "", p.anonymity || ""].join(" ").toLowerCase();
        if (!t.includes(keyword)) return false;
      }
      return true;
    });

    if (!list.length) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 6;
      td.style.color = "#fecaca";
      td.style.fontSize = "12px";
      td.textContent = currentLang === "zh"
        ? "æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•ä»£ç†ã€‚"
        : "No proxies match current filters.";
      tr.appendChild(td);
      tbody.appendChild(tr);
    } else {
      list.forEach((p, i) => {
        const tr = document.createElement("tr");
        const tdIdx = document.createElement("td");
        tdIdx.textContent = i + 1;
        tr.appendChild(tdIdx);

        const tdC = document.createElement("td");
        tdC.textContent = p.country || "-";
        tr.appendChild(tdC);

        const tdIP = document.createElement("td");
        tdIP.className = "mono";
        tdIP.textContent = `${p.ip}:${p.port}`;
        tr.appendChild(tdIP);

        const tdProto = document.createElement("td");
        tdProto.textContent = p.protocol || "-";
        tr.appendChild(tdProto);

        const tdAnon = document.createElement("td");
        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = p.anonymity || "-";
        tdAnon.appendChild(chip);
        tr.appendChild(tdAnon);

        const tdSpeed = document.createElement("td");
		const bar = document.createElement("span");
		bar.className = "speed-bar";
		const inner = document.createElement("div");

		// åˆ¤æ–­æ˜¯å¦çœŸçš„æœ‰é€Ÿåº¦
		let hasSpeed = p.speed !== null && p.speed !== undefined && p.speed !== "" && !Number.isNaN(Number(p.speed));
		let speedNum = hasSpeed ? Number(p.speed) : null;

		if (hasSpeed) {
		  // æœ‰é€Ÿåº¦ï¼šæ­£å¸¸ç”»å½©è‰²æ¡ + æ•°å­—
		  inner.style.transform = `scaleX(${Math.max(0.2, Math.min(1, (160 - speedNum) / 160)).toFixed(2)})`;
		} else {
		  // æ²¡é€Ÿåº¦ï¼šæ¡å˜æˆ 0ï¼ˆæˆ–ä½ å–œæ¬¢è®¾ç½® 0.2ï¼‰ï¼Œåªæ˜¯å½“è£…é¥°
		  inner.style.transform = "scaleX(0)";
		}

		bar.appendChild(inner);
		tdSpeed.appendChild(bar);

		const txt = document.createElement("span");
		if (hasSpeed) {
		  txt.textContent = `${speedNum} ms`;
		} else {
		  txt.textContent = currentLang === "zh" ? "-" : "-";
		}
		tdSpeed.appendChild(txt);

		tr.appendChild(tdSpeed);

        tbody.appendChild(tr);
      });
    }
    updateStats();
    fillProxySelect(list);
  }

  async function loadProxies() {
    const tbody = document.getElementById("proxy-tbody");
    if (tbody) {
      tbody.innerHTML = `<tr><td colspan="6" style="font-size:12px;">${
        currentLang === "zh" ? "æ­£åœ¨åŠ è½½ proxies.json..." : "Loading proxies.json..."
      }</td></tr>`;
    }
    try {
      const res = await fetch(API_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const json = await res.json();
      allProxies = json.data || [];
      lastUpdated = json.updated_at || "";
    } catch (e) {
      console.error("åŠ è½½ proxies.json å¤±è´¥ï¼š", e);
      allProxies = [];
      lastUpdated = "";
    }
    renderCountryFilter();
    applyFiltersAndRender();
    setUpdateTime();
  }

  document.getElementById("search-input").addEventListener("input", applyFiltersAndRender);
  document.getElementById("country-filter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("protocol-filter").addEventListener("change", applyFiltersAndRender);

  /**************** æµ‹è¯•å®éªŒå®¤ï¼šæ¨¡æ‹Ÿæµç¨‹ + curl å‘½ä»¤ ****************/
  function selectedProxy() {
    const sel = document.getElementById("proxy-select");
    if (!sel) return null;
    const opt = sel.options[sel.selectedIndex];
    if (!opt || !opt.dataset.ip) return null;
    return {
      ip: opt.dataset.ip,
      port: opt.dataset.port,
      protocol: opt.dataset.protocol
    };
  }

  function updatePreviewCmd() {
    const proxy = selectedProxy();
    const url = document.getElementById("test-url").value.trim() || "https://httpbin.org/ip";
    const cmd = proxy
      ? `curl -x ${String(proxy.protocol || "http").toLowerCase().split(",")[0].trim()}://${proxy.ip}:${proxy.port} \\\n  -H "User-Agent: PikachuProxy/1.0" \\\n  "${url}"`
      : `curl -x http://IP:PORT \\\n  -H "User-Agent: PikachuProxy/1.0" \\\n  "${url}"`;
    document.getElementById("preview-cmd").textContent = cmd;
  }

  document.getElementById("test-url").addEventListener("input", updatePreviewCmd);
  document.getElementById("proxy-select").addEventListener("change", updatePreviewCmd);

  function setStatus(state) {
    const pill = document.getElementById("status-pill");
    pill.classList.remove("status-idle", "status-running", "status-error");
    if (state === "running") {
      pill.classList.add("status-running");
      pill.textContent = currentLang === "zh" ? "âš™ï¸ æµ‹è¯•ä¸­..." : "âš™ï¸ Running...";
    } else if (state === "error") {
      pill.classList.add("status-error");
      pill.textContent = currentLang === "zh" ? "âŒ é”™è¯¯" : "âŒ Error";
    } else {
      pill.classList.add("status-idle");
      pill.textContent = currentLang === "zh" ? "ğŸ’¤ ç©ºé—²" : "ğŸ’¤ Idle";
    }
  }

  function logLine(text) {
    const box = document.getElementById("log-box");
    const div = document.createElement("div");
    div.textContent = text;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  }

  document.getElementById("run-btn").addEventListener("click", () => {
    const proxy = selectedProxy();
    const url = document.getElementById("test-url").value.trim() || "https://httpbin.org/ip";
    const box = document.getElementById("log-box");
    box.innerHTML = "";
    if (!proxy) {
      setStatus("error");
      logLine(currentLang === "zh" ? "[ç³»ç»Ÿ] è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»£ç†ã€‚" : "[system] Please choose a proxy first.");
      setTimeout(() => setStatus("idle"), 1000);
      return;
    }
    setStatus("running");
    const stepsZh = [
      `ğŸ§ª [æ­¥éª¤ 1] æ„å»ºè¯·æ±‚ï¼šç›®æ ‡ URL = ${url}`,
      `âš¡ [æ­¥éª¤ 2] é€šè¿‡ä»£ç†è¿æ¥ï¼š${proxy.ip}:${proxy.port} (${proxy.protocol})`,
      "ğŸ“¡ [æ­¥éª¤ 3] å‘é€ HTTP è¯·æ±‚ï¼ˆæ¨¡æ‹Ÿï¼‰...",
      "â±ï¸ [æ­¥éª¤ 4] ç­‰å¾…å“åº”ä¸­ï¼ˆçº¦ 300msï¼‰...",
      "âœ… [æ­¥éª¤ 5] è¯·æ±‚æˆåŠŸï¼ˆç¤ºæ„æ•°æ®ï¼‰ï¼šçŠ¶æ€ç  200ã€‚",
      `ğŸ“¦ [ç¤ºä¾‹è¿”å›ä½“] {"origin": "${proxy.ip}"}`
    ];
    const stepsEn = [
      `ğŸ§ª [Step 1] Build request: target URL = ${url}`,
      `âš¡ [Step 2] Connect via proxy: ${proxy.ip}:${proxy.port} (${proxy.protocol})`,
      "ğŸ“¡ [Step 3] Send HTTP request (simulated)...",
      "â±ï¸ [Step 4] Waiting for response (~300ms)...",
      "âœ… [Step 5] Request succeeded (mock data): status 200.",
      `ğŸ“¦ [Sample body] {"origin": "${proxy.ip}"}`
    ];
    const steps = currentLang === "zh" ? stepsZh : stepsEn;
    let i = 0;
    function next() {
      if (i >= steps.length) {
        setStatus("idle");
        return;
      }
      logLine(steps[i++]);
      setTimeout(next, 420);
    }
    next();
  });

  /**************** å¯åŠ¨ï¼šè¯­è¨€ + åŠ è½½æ•°æ® ****************/
  applyLang();
  loadProxies();
</script>
</body>
</html>
